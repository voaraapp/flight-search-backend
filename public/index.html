<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Flight Search Flex</title>
<style>
body { font-family: Arial; padding: 20px; }
.chip { background: #007bff; color: #fff; padding: 5px 10px; margin: 4px; border-radius: 16px; display: inline-block; cursor: pointer; }
.card { border: 1px solid #ddd; padding: 10px; margin-top: 8px; border-radius: 6px; }
</style>
</head>
<body>

<h2>Multi-Airport Flex Search</h2>

<label>Depart Airports:</label><br>
<input id="depInput" placeholder="e.g. EDI">
<button onclick="addDep()">Add</button>
<div id="depChips"></div>

<br><br>

<label>Arrival Airports:</label><br>
<input id="arrInput" placeholder="e.g. LGW">
<button onclick="addArr()">Add</button>
<div id="arrChips"></div>

<br><br>

<label>Departure Date: </label>
<input id="depDate" type="date">

<label>Return Date: </label>
<input id="retDate" type="date">

<br><br>

<button onclick="searchFlights()">Search Flights</button>
<div id="results"></div>

<script>
let departures = [];
let arrivals = [];

function addDep() {
  const val = document.getElementById('depInput').value.toUpperCase();
  if (val) { departures.push(val); renderChips(); }
}

function addArr() {
  const val = document.getElementById('arrInput').value.toUpperCase();
  if (val) { arrivals.push(val); renderChips(); }
}

function removeChip(list, index) {
  list.splice(index, 1);
  renderChips();
}

function renderChips() {
  document.getElementById('depChips').innerHTML =
    departures.map((d,i)=>`<span class='chip' onclick='removeChip(departures,${i})'>${d} ✕</span>`).join("");

  document.getElementById('arrChips').innerHTML =
    arrivals.map((a,i)=>`<span class='chip' onclick='removeChip(arrivals,${i})'>${a} ✕</span>`).join("");
}

async function searchFlights() {
  const depDate = document.getElementById("depDate").value;
  const retDate = document.getElementById("retDate").value;

  let resDiv = document.getElementById("results");
  resDiv.innerHTML = "<p>Searching...⏳</p>";

  const response = await fetch("/api/search-flex", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({
      departures,
      arrivals,
      departureDate: depDate,
      returnDate: retDate,
      adults: 1,
      currency: "GBP"
    })
  });

  const data = await response.json();
  resDiv.innerHTML = data.results.length === 0 ?
    "<p>No flights found</p>" :
    data.results.map(f => `
      <div class="card">
        <strong>${f.from} → ${f.to}</strong><br>
        Out: ${f.outDeparture}<br>
        Back: ${f.returnDeparture}<br>
        Airline: ${f.airline}<br>
        Stops: ${f.stopsOutbound}/${f.stopsInbound}<br>
        Price: £${f.price}
      </div>
    `).join("");
}
</script>

</body>
</html>
